var _=function(M){"use strict";var ee=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function se(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var F={exports:{}};(function(s,n){(function(m,A){A(s)})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:ee,function(m){var A,k;if(!((k=(A=globalThis.chrome)==null?void 0:A.runtime)!=null&&k.id))throw new Error("This script should only be loaded in a browser extension.");if(typeof globalThis.browser>"u"||Object.getPrototypeOf(globalThis.browser)!==Object.prototype){const O="The message port closed before a response was received.",K=w=>{const $={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys($).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class Z extends WeakMap{constructor(r,a=void 0){super(a),this.createItem=r}get(r){return this.has(r)||this.set(r,this.createItem(r)),super.get(r)}}const be=e=>e&&typeof e=="object"&&typeof e.then=="function",J=(e,r)=>(...a)=>{w.runtime.lastError?e.reject(new Error(w.runtime.lastError.message)):r.singleCallbackArg||a.length<=1&&r.singleCallbackArg!==!1?e.resolve(a[0]):e.resolve(a)},E=e=>e==1?"argument":"arguments",we=(e,r)=>function(i,...d){if(d.length<r.minArgs)throw new Error(`Expected at least ${r.minArgs} ${E(r.minArgs)} for ${e}(), got ${d.length}`);if(d.length>r.maxArgs)throw new Error(`Expected at most ${r.maxArgs} ${E(r.maxArgs)} for ${e}(), got ${d.length}`);return new Promise((u,f)=>{if(r.fallbackToNoCallback)try{i[e](...d,J({resolve:u,reject:f},r))}catch(t){console.warn(`${e} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,t),i[e](...d),r.fallbackToNoCallback=!1,r.noCallback=!0,u()}else r.noCallback?(i[e](...d),u()):i[e](...d,J({resolve:u,reject:f},r))})},Y=(e,r,a)=>new Proxy(r,{apply(i,d,u){return a.call(d,e,...u)}});let P=Function.call.bind(Object.prototype.hasOwnProperty);const T=(e,r={},a={})=>{let i=Object.create(null),d={has(f,t){return t in e||t in i},get(f,t,x){if(t in i)return i[t];if(!(t in e))return;let c=e[t];if(typeof c=="function")if(typeof r[t]=="function")c=Y(e,e[t],r[t]);else if(P(a,t)){let h=we(t,a[t]);c=Y(e,e[t],h)}else c=c.bind(e);else if(typeof c=="object"&&c!==null&&(P(r,t)||P(a,t)))c=T(c,r[t],a[t]);else if(P(a,"*"))c=T(c,r[t],a["*"]);else return Object.defineProperty(i,t,{configurable:!0,enumerable:!0,get(){return e[t]},set(h){e[t]=h}}),c;return i[t]=c,c},set(f,t,x,c){return t in i?i[t]=x:e[t]=x,!0},defineProperty(f,t,x){return Reflect.defineProperty(i,t,x)},deleteProperty(f,t){return Reflect.deleteProperty(i,t)}},u=Object.create(e);return new Proxy(u,d)},I=e=>({addListener(r,a,...i){r.addListener(e.get(a),...i)},hasListener(r,a){return r.hasListener(e.get(a))},removeListener(r,a){r.removeListener(e.get(a))}}),he=new Z(e=>typeof e!="function"?e:function(a){const i=T(a,{},{getContent:{minArgs:0,maxArgs:0}});e(i)}),X=new Z(e=>typeof e!="function"?e:function(a,i,d){let u=!1,f,t=new Promise(C=>{f=function(p){u=!0,C(p)}}),x;try{x=e(a,i,f)}catch(C){x=Promise.reject(C)}const c=x!==!0&&be(x);if(x!==!0&&!c&&!u)return!1;const h=C=>{C.then(p=>{d(p)},p=>{let B;p&&(p instanceof Error||typeof p.message=="string")?B=p.message:B="An unexpected error occurred",d({__mozWebExtensionPolyfillReject__:!0,message:B})}).catch(p=>{console.error("Failed to send onMessage rejected reply",p)})};return h(c?x:t),!0}),ye=({reject:e,resolve:r},a)=>{w.runtime.lastError?w.runtime.lastError.message===O?r():e(new Error(w.runtime.lastError.message)):a&&a.__mozWebExtensionPolyfillReject__?e(new Error(a.message)):r(a)},Q=(e,r,a,...i)=>{if(i.length<r.minArgs)throw new Error(`Expected at least ${r.minArgs} ${E(r.minArgs)} for ${e}(), got ${i.length}`);if(i.length>r.maxArgs)throw new Error(`Expected at most ${r.maxArgs} ${E(r.maxArgs)} for ${e}(), got ${i.length}`);return new Promise((d,u)=>{const f=ye.bind(null,{resolve:d,reject:u});i.push(f),a.sendMessage(...i)})},ke={devtools:{network:{onRequestFinished:I(he)}},runtime:{onMessage:I(X),onMessageExternal:I(X),sendMessage:Q.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:Q.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},j={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return $.privacy={network:{"*":j},services:{"*":j},websites:{"*":j}},T(w,ke,$)};m.exports=K(chrome)}else m.exports=globalThis.browser})})(F);var re=F.exports;const o=se(re),U=60*1e3,W=10*1e3,q="https://app.cyberyozh.com",D="wss://app.cyberyozh.com",ne=`${q}/api/v1`,te=`${D}/ws/sms_update_number`,ae=`${D}/ws/proxy_history_update`,oe={defaultScreen:{value:"proxy",label:"Proxies"},isNotificationEnabled:!0,isSoundEnabled:!0};let g=null;const ie=s=>{const n=`${ae}/?token=${s}`;g=new WebSocket(n),g.onopen=()=>{console.warn(`Proxy Socket opened: ${g}`)},g.onmessage=ge,g.onclose=m=>{if(g){if(m.type==="close"&&m.code===4401){console.warn("Proxies socket is closed. Unauthorized.");return}g=null}},g.onerror=m=>{console.error("Proxies socket encountered error: ",m.message,"Closing socket"),g==null||g.close()}},ge=s=>{const m={type:"proxies-socket",target:"proxy-screen",data:JSON.parse(s.data)};o.runtime.sendMessage(m).catch(A=>console.warn("Popup closed, no receiving end"))},le=()=>{const s=setInterval(()=>{g&&g.readyState===WebSocket.OPEN?g.send("ping"):clearInterval(s)},W)},S=[],R="<all_urls>";let b=null;async function me(){const s=await o.storage.local.get("proxyConfig");s.proxyConfig?b=s.proxyConfig:b=null}function ce(s,n){n==="local"&&s.proxyConfig&&(b=s.proxyConfig.newValue)}function z(s){const n=S.indexOf(s.requestId);n>-1&&S.splice(n,1)}function V(s){return S.includes(s.requestId)?{cancel:!0}:(S.push(s.requestId),b?{authCredentials:{username:b.login,password:b.password}}:{})}const Ae=async s=>{{if(!y)try{await chrome.offscreen.createDocument({url:"offscreen.html",reasons:[chrome.offscreen.Reason.CLIPBOARD],justification:"Write text to clipboard."}),y=!0}catch(n){console.error("Failed to create offscreen document:",n);return}try{await chrome.runtime.sendMessage({type:"copy-data-to-clipboard",target:"offscreen-doc",data:s})}catch(n){console.error("Failed to send message to offscreen document:",n)}y=!1}},de=async()=>{y||(await chrome.offscreen.createDocument({url:"offscreen.html",reasons:[chrome.offscreen.Reason.AUDIO_PLAYBACK],justification:"Play notification sound."}),y=!0),await chrome.runtime.sendMessage({type:"play-notification-sound",target:"offscreen-doc"})};let y=!1,l=null;const ue=s=>{const n=`${te}/?token=${s}`;l=new WebSocket(n),l.onopen=()=>{console.warn(`SMS Socket opened: ${l}`)},l.onmessage=fe,l.onclose=m=>{if(l){if(m.type==="close"&&m.code===4401){console.warn("SMS socket is closed. Unauthorized.");return}l=null}},l.onerror=m=>{console.error("SMS socket encountered error: ",m.message,"Closing socket"),l==null||l.close()}},fe=async s=>{const n=JSON.parse(s.data);if(n.field==="updateSmsCodeHistory"&&n.id&&n.value){v[n.id]={sms:n.value.codes[0],phone:n.value.phone},await o.storage.local.set({newReceivedSms:v});const A={type:"sms-socket",target:"new-sms-notification-badge",data:n};await o.runtime.sendMessage(A).catch(K=>console.warn("Popup closed, no receiving end"));const{isNotificationEnabled:k}=await o.storage.local.get("isNotificationEnabled");k!==!1&&o.alarms.create(`sms-${n.id}`,{when:Date.now()});const{isSoundEnabled:O}=await o.storage.local.get("isSoundEnabled");O!==!1&&de()}if(n.field==="updateBalance"){const A={type:"sms-socket",target:"update-balance",data:n};await o.runtime.sendMessage(A).catch(k=>console.warn("Popup closed, no receiving end"))}const m={type:"sms-socket",target:"sms-screen",data:n};await o.runtime.sendMessage(m).catch(A=>console.warn("Popup closed, no receiving end"))},xe=()=>{const s=setInterval(()=>{l&&l.readyState===WebSocket.OPEN?l.send("ping"):clearInterval(s)},W)};let v={};const G=async s=>{var A;const n=(A=v[s])==null?void 0:A.sms;if(!n){console.warn("No notifications for current number");return}await Ae(n);const m=await o.storage.local.get("newReceivedSms");delete m.newReceivedSms[s],await o.storage.local.set(m),await o.notifications.clear(s)};o.notifications.onClicked.addListener(G),o.notifications.onButtonClicked.addListener(G),o.runtime.onInstalled.addListener(async()=>{await pe(),await L()}),o.runtime.onStartup.addListener(async()=>{await L()}),o.runtime.onMessage.addListener(async s=>{s.type==="init-sockets"&&await L()});const pe=async()=>{await o.storage.local.set(oe)},L=async()=>{await H(),o.storage.onChanged.addListener(ce),o.alarms.create("refreshToken",{periodInMinutes:U/6e4}),await N()},H=async()=>{await me(),o.webRequest.onAuthRequired.removeListener(V),o.webRequest.onAuthRequired.addListener(V,{urls:[R]},["blocking"]),o.webRequest.onCompleted.addListener(z,{urls:[R]}),o.webRequest.onErrorOccurred.addListener(z,{urls:[R]})},N=async()=>{try{const s=await fetch(`${ne}/users/token/`,{credentials:"include"});if(s.status===403){console.warn("Unauthorized"),l==null||l.close(),g==null||g.close(),await o.alarms.clear("refreshToken");return}if(s.status===502){await o.cookies.remove({url:q,name:"sessionid"}),await o.alarms.clear("refreshToken");return}if(s.ok){const n=await s.json();n.access&&((!l||l.readyState!==WebSocket.OPEN)&&(ue(n.access),xe()),(!g||g.readyState!==WebSocket.OPEN)&&(ie(n.access),le()))}}catch(s){console.error("Couldn't get token",s)}};return o.alarms.onAlarm.addListener(async s=>{if(s.name==="refreshToken")await N();else if(s.name==="retryInit")await N(),o.alarms.create("refreshToken",{periodInMinutes:U/6e4});else if(s.name.startsWith("sms-")){const n=s.name.replace("sms-",""),{sms:m,phone:A}=v[n];await o.notifications.create(n,{type:"basic",iconUrl:"/logo.png",title:`Новое SMS для ${A}`,message:m,priority:2})}}),o.runtime.onSuspend.addListener(()=>{console.warn("Background script is being suspended."),l==null||l.close(),g==null||g.close()}),M.ensureProxyConfigLoaded=H,Object.defineProperty(M,Symbol.toStringTag,{value:"Module"}),M}({});
