name: Build and Release

on:
  push:
    tags:
      - 'v*'

permissions:
  contents: write

jobs:
  build:
    runs-on: windows-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.13'
        cache: 'pip'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        python -m pip install flet==0.28.3 playwright==1.56.0 requests geoip2 pproxy PySocks timezonefinder pyinstaller
    
    - name: Build with PyInstaller
      run: |
        echo "Starting PyInstaller build..."
        pyinstaller --windowed --name antic --add-data "GeoLite2-Country.mmdb;." --add-data "extensions;extensions" --collect-all flet --hidden-import=playwright --hidden-import=geoip2 --hidden-import=pproxy antic.py
        echo "Build completed!"
        dir dist\antic
    
    - name: Create ZIP archive
      run: |
        cd dist
        powershell Compress-Archive -Path antic -DestinationPath antic-windows.zip
        dir
    
    - name: Create Release
      uses: softprops/action-gh-release@v2
      with:
        files: dist/antic-windows.zip
        draft: false
        prerelease: false
        body: |
          ## üöÄ Antic Browser ${{ github.ref_name }}
          
          –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–±–æ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏ ${{ github.ref_name }}
          
          ### üì• –£—Å—Ç–∞–Ω–æ–≤–∫–∞:
          1. –°–∫–∞—á–∞–π [antic-windows.zip](https://github.com/${{ github.repository }}/releases/download/${{ github.ref_name }}/antic-windows.zip)
          2. –†–∞—Å–ø–∞–∫—É–π –≤ –ª—é–±—É—é –ø–∞–ø–∫—É
          3. –ó–∞–ø—É—Å—Ç–∏ `antic.exe`
          
          ### ‚ú® –ß—Ç–æ –≤–∫–ª—é—á–µ–Ω–æ:
          - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
          - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å CyberYozh –∏ SX.ORG
          - –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ CyberYozh –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–æ
          - GEO –∞–≤—Ç–æ–Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥ –ø—Ä–æ–∫—Å–∏
          - –í—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ñ–∞–π–ª—ã –∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
        generate_release_notes: true
